<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>UMBRELLA</title>
    <!-- Bootstrap4 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    
    <script src="./js/showdown.min.js"></script>
    <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
	<div class="container mycontainer">
		<div class="row">
			<div class="col-sm-12 text-center">
				<h1>Welcome to my test blog</h1>
				<!-- BEGIN IMAGE SLIDER -->
				<div id="myCarousel" class="carousel slide" data-ride="carousel">
					<!-- Indicators -->
					<ol class="carousel-indicators" style="display:none">
					  <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
					  <li data-target="#myCarousel" data-slide-to="1"></li>
					  <li data-target="#myCarousel" data-slide-to="2"></li>
					  <li data-target="#myCarousel" data-slide-to="3"></li>
					  <li data-target="#myCarousel" data-slide-to="4"></li>
					  <li data-target="#myCarousel" data-slide-to="5"></li>
					</ol>
					<!-- Wrapper for slides -->
					<div class="carousel-inner slider">
						<div class="item active">
							<img src="assets/img1.png" alt="img1">
						</div>
						<div class="item">
							<img src="assets/img2.png" alt="img2">
						</div>
						<div class="item">
							<img src="assets/img3.png" alt="img3">
						</div>
						<div class="item">
							<img src="assets/img4.png" alt="img4">
						</div>
						<div class="item">
							<img src="assets/img5.jpeg" alt="img5">
						</div>
						<div class="item">
							<img src="assets/img6.png" alt="img6">
						</div>
					</div>
					<!-- Left and right controls -->
					<a class="left carousel-control" href="#myCarousel" data-slide="prev">
						<span class="glyphicon glyphicon-chevron-left"></span>
						<span class="sr-only">Previous</span>
					</a>
					<a class="right carousel-control" href="#myCarousel" data-slide="next">
						<span class="glyphicon glyphicon-chevron-right"></span>
						<span class="sr-only">Next</span>
					</a>
				</div>
			</div>
		</div>
		<div class="row">
			<div id="Posts" class="col-sm-12"></div>
		</div>
		<div class="row">
			<br>
			<div id="BtnPrev" class="col-sm-6 text-left"></div>
			<div id="BtnNext" class="col-sm-6 text-right"></div>
		</div>
		<div class="row">
			<div class="col-sm-12 text-center">
				<br>
				<h4>This page is intended to be test page for markdown parser! <a href="https://www.umbrellafwd.tk/">https://www.umbrellafwd.tk/</a> will be migrated here!</h4>
			</div>
		</div>
    </div>
    
    <!-- MARKDOWN PARSER SECTION -->
    <script>
	//get post index
		fetch('./posts/index.md').then(
			function(response) {
				if (response.status !== 200) {
					showMarkdown('# Looks like there was a problem. Status Code: ' +
						response.status,'#','#');
					return;
				}
				response.text().then(text => getPostsArray(text));
				console.log('[INDEX] fetch success!');
			}
		)
		.catch(function(err) {
			console.log('Fetch Error :-S', err);
		});
		
	//get post array and parse to markdown
		function getPostsArray(text){
			var arrPosts = text.split("\n");
		//reverse post to show latest content
			arrPosts.reverse(); 
		//filter array (remove empty value)
			var arrPosts = arrPosts.filter(function(el) { return el; });
			//console.log(arrPosts);
			
		//get requested post from url
			var url = window.location.hash.substr(1);
			var hash = url.substring(url.indexOf('#')+1);
			//console.log(hash);
		
		//if user request specific post
			if(hash !== null && hash !== ''){
			//check if post url valid
				for(var i=0; i<arrPosts.length; i++){
					if(hash == arrPosts[i]){
					//set shown post
						var post="./posts/"+hash+"/index.md";
						//console.log(post);
					//set prev and next post
						var prevPost;
						if(i-1 < 0){prevPost = "#";}else{prevPost = '#'+arrPosts[i-1];}
						var nextPost;
						if(i+1 >= arrPosts.length){nextPost = "#";}else{nextPost = '#'+arrPosts[i+1];}
					//get post and parse to html
						fetch(post).then(
							function(response) {
								if (response.status !== 200) {
									showMarkdown('Looks like there was a problem. Status Code: ' +
										response.status,prevPost,nextPost);
									return;
								}
								response.text().then(text => showMarkdown(text,prevPost,nextPost));
								console.log('[POST] fetch success! '+arrPosts.length);
							}
						)
						.catch(function(err) {
							console.log('Fetch Error :-S', err);
						});
					}
				}
		//if no specific post requested
			}else{
				var post="./posts/"+arrPosts[0]+"/index.md";
				//console.log(post);
				fetch(post).then(
					function(response) {
						if (response.status !== 200) {
							showMarkdown('Looks like there was a problem. Status Code: ' +
								response.status,"#","#");
							return;
						}
						var nextPost = '#' + arrPosts[1];
						response.text().then(text => showMarkdown(text,'#',nextPost));
						console.log('[POST] fetch success!');
					}
				)
				.catch(function(err) {
					console.log('Fetch Error :-S', err);
				});
			}
		}
		
	//markdown parser
        function showMarkdown(markdown,prevPost,nextPost){
			var converter = new showdown.Converter();
			var html = converter.makeHtml(markdown);
			document.getElementById('Posts').innerHTML = html;
			if(prevPost != '#'){
				var BtnPrev = "<button class='btn btn-info' onclick=\"location.href='"+prevPost+"';location.reload()\">Sebelumnya</button>";
				document.getElementById('BtnPrev').innerHTML = BtnPrev;
				//console.log(BtnPrev);
			}
			if(nextPost != '#'){
				var BtnNext = "<button class='btn btn-info' onclick=\"location.href='"+nextPost+"';location.reload()\">Selanjutnya</button>"; 				
				document.getElementById('BtnNext').innerHTML = BtnNext;
				//console.log(BtnNext);
			}
		}
    </script>
    
</body>
</html>
